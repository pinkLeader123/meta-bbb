From 9c6aedc26b0f5dc4e368d78121b5d4b8efb0e619 Mon Sep 17 00:00:00 2001
From: dangphuc20 <dangphuc20802@gmail.com>
Date: Sat, 1 Nov 2025 16:36:49 +0700
Subject: [PATCH] add func display ip

---
 src/main.c | 296 ++++++++++++++++++++++++++++++++++++++---------------
 1 file changed, 214 insertions(+), 82 deletions(-)

diff --git a/src/main.c b/src/main.c
index 5e1136d..86bd9c8 100644
--- a/src/main.c
+++ b/src/main.c
@@ -1,113 +1,245 @@
 #include <stdio.h>
+
 #include <stdlib.h>
+
 #include <string.h>
+
 #include <unistd.h>
+
 #include <fcntl.h>
+
 #include <linux/i2c-dev.h>
+
 #include <sys/ioctl.h>
+
 #include <stdint.h>
 
+
 #define I2C_ADDR 0x3C
-#define I2C_DEV "/dev/i2c-1"
+
+#define I2C_DEV "/dev/i2c-2"
+
 
 int i2c_fd;
 
+
 void ssd1315_send_command(uint8_t cmd) {
-    uint8_t buffer[2] = {0x00, cmd}; // Co=0, D/C#=0 (command)
-    write(i2c_fd, buffer, 2);
+
+	uint8_t buffer[2] = {0x00, cmd}; // Co=0, D/C#=0 (command)
+
+	write(i2c_fd, buffer, 2);
+
 }
 
+
 void ssd1315_send_data(uint8_t *data, size_t len) {
-    uint8_t *buffer = malloc(len + 1);
-    buffer[0] = 0x40; // Co=0, D/C#=1 (data)
-    memcpy(buffer + 1, data, len);
-    write(i2c_fd, buffer, len + 1);
-    free(buffer);
+
+	uint8_t *buffer = malloc(len + 1);
+
+	buffer[0] = 0x40; // Co=0, D/C#=1 (data)
+
+	memcpy(buffer + 1, data, len);
+
+	write(i2c_fd, buffer, len + 1);
+
+	free(buffer);
+
 }
 
+
 void ssd1315_init() {
-    ssd1315_send_command(0xAE); // Display off
-    ssd1315_send_command(0x20); // Set Memory Addressing Mode
-    ssd1315_send_command(0x10); // Page addressing mode
-    ssd1315_send_command(0xB0); // Page 0
-    ssd1315_send_command(0xC8); // COM scan direction remapped
-    ssd1315_send_command(0x00); // Low column address
-    ssd1315_send_command(0x10); // High column address
-    ssd1315_send_command(0x40); // Start line
-    ssd1315_send_command(0x81); ssd1315_send_command(0xFF); // Max contrast
-    ssd1315_send_command(0xA1); // Segment remap
-    ssd1315_send_command(0xA6); // Normal display
-    ssd1315_send_command(0xA8); ssd1315_send_command(0x3F); // MUX ratio
-    ssd1315_send_command(0xA4); // Resume RAM content
-    ssd1315_send_command(0xD3); ssd1315_send_command(0x00); // Display offset
-    ssd1315_send_command(0xD5); ssd1315_send_command(0xF0); // Clock divide
-    ssd1315_send_command(0xD9); ssd1315_send_command(0x22); // Pre-charge
-    ssd1315_send_command(0xDA); ssd1315_send_command(0x12); // COM config
-    ssd1315_send_command(0xDB); ssd1315_send_command(0x20); // VCOM detect
-    ssd1315_send_command(0x8D); ssd1315_send_command(0x14); // Charge pump
-    ssd1315_send_command(0xAF); // Display ON
+
+	ssd1315_send_command(0xAE); // Display off
+
+	ssd1315_send_command(0x20); // Set Memory Addressing Mode
+
+	ssd1315_send_command(0x10); // Page addressing mode
+
+	ssd1315_send_command(0xB0); // Page 0
+
+	ssd1315_send_command(0xC8); // COM scan direction remapped
+
+	ssd1315_send_command(0x00); // Low column address
+
+	ssd1315_send_command(0x10); // High column address
+
+	ssd1315_send_command(0x40); // Start line
+
+	ssd1315_send_command(0x81);
+	ssd1315_send_command(0xFF); // Max contrast
+
+	ssd1315_send_command(0xA1); // Segment remap
+
+	ssd1315_send_command(0xA6); // Normal display
+
+	ssd1315_send_command(0xA8);
+	ssd1315_send_command(0x3F); // MUX ratio
+
+	ssd1315_send_command(0xA4); // Resume RAM content
+
+	ssd1315_send_command(0xD3);
+	ssd1315_send_command(0x00); // Display offset
+
+	ssd1315_send_command(0xD5);
+	ssd1315_send_command(0xF0); // Clock divide
+
+	ssd1315_send_command(0xD9);
+	ssd1315_send_command(0x22); // Pre-charge
+
+	ssd1315_send_command(0xDA);
+	ssd1315_send_command(0x12); // COM config
+
+	ssd1315_send_command(0xDB);
+	ssd1315_send_command(0x20); // VCOM detect
+
+	ssd1315_send_command(0x8D);
+	ssd1315_send_command(0x14); // Charge pump
+
+	ssd1315_send_command(0xAF); // Display ON
+
 }
 
-// Basic 5x8 font for ASCII chars 32â€“127
+
+// Basic 5x8 font for ASCII chars 32b127
+
 uint8_t font5x8[][5] = {
-    // Only showing some characters; fill this out if needed
-    [0] = { 0x00, 0x00, 0x00, 0x00, 0x00 }, // space
-    [1] = { 0x5F, 0x00, 0x00, 0x00, 0x00 }, // !
-    // ...
-    ['H' - 32] = {0x7F, 0x08, 0x08, 0x08, 0x7F}, // H
-    ['e' - 32] = {0x3C, 0x4A, 0x4A, 0x4A, 0x30}, // e
-    ['l' - 32] = {0x00, 0x41, 0x7F, 0x40, 0x00}, // l
-    ['o' - 32] = {0x38, 0x44, 0x44, 0x44, 0x38}, // o
-    [' ' - 32] = {0x00, 0x00, 0x00, 0x00, 0x00}, // space
-    ['W' - 32] = {0x7C, 0x02, 0x0C, 0x02, 0x7C}, // W
-    ['r' - 32] = {0x7C, 0x08, 0x04, 0x04, 0x08}, // r
-    ['d' - 32] = {0x38, 0x44, 0x44, 0x44, 0x7F}, // d
+
+// Only showing some characters; fill this out if needed
+
+	[0] = { 0x00, 0x00, 0x00, 0x00, 0x00 }, // space
+
+	[1] = { 0x5F, 0x00, 0x00, 0x00, 0x00 }, // !
+
+// ...
+
+	['H' - 32] = {0x7F, 0x08, 0x08, 0x08, 0x7F}, // H
+
+	['e' - 32] = {0x3C, 0x4A, 0x4A, 0x4A, 0x30}, // e
+
+	['l' - 32] = {0x00, 0x41, 0x7F, 0x40, 0x00}, // l
+
+	['o' - 32] = {0x38, 0x44, 0x44, 0x44, 0x38}, // o
+
+	[' ' - 32] = {0x00, 0x00, 0x00, 0x00, 0x00}, // space
+
+	['W' - 32] = {0x7C, 0x02, 0x0C, 0x02, 0x7C}, // W
+
+	['r' - 32] = {0x7C, 0x08, 0x04, 0x04, 0x08}, // r
+
+	['d' - 32] = {0x38, 0x44, 0x44, 0x44, 0x7F}, // d
+
+	['.' - 32] = {0x00, 0x60, 0x60, 0x00, 0x00},
+
+	['0' - 32] = {0x3e, 0x51, 0x49, 0x45, 0x3e},
+
+	['1' - 32] = {0x00, 0x42, 0x7f, 0x40, 0x00}, // 31 1
+
+	['2' - 32] = {0x42, 0x61, 0x51, 0x49, 0x46}, // 32 2
+
+	['3' - 32] = {0x21, 0x41, 0x45, 0x4b, 0x31}, // 33 3
+
+	['4' - 32] = {0x18, 0x14, 0x12, 0x7f, 0x10}, // 34 4
+
+	['5' - 32] = {0x27, 0x45, 0x45, 0x45, 0x39}, // 35 5
+
+	['6' - 32] = {0x3c, 0x4a, 0x49, 0x49, 0x30}, // 36 6
+
+	['7' - 32] = {0x01, 0x71, 0x09, 0x05, 0x03}, // 37 7
+
+	['8' - 32] = {0x36, 0x49, 0x49, 0x49, 0x36},// 38 8
+
+	['9' - 32] = {0x06, 0x49, 0x49, 0x29, 0x1e}, // 39 9
+
 };
 
+
 void ssd1315_clear() {
-    for (int page = 0; page < 8; ++page) {
-        ssd1315_send_command(0xB0 + page);
-        ssd1315_send_command(0x00);
-        ssd1315_send_command(0x10);
-        uint8_t zero[128] = {0};
-        ssd1315_send_data(zero, 128);
-    }
+
+	for (int page = 0; page < 8; ++page) {
+
+		ssd1315_send_command(0xB0 + page);
+
+		ssd1315_send_command(0x00);
+
+		ssd1315_send_command(0x10);
+
+		uint8_t zero[128] = {0};
+
+		ssd1315_send_data(zero, 128);
+
+	}
+
 }
 
+
 void ssd1315_write_text(const char *text, int page, int col) {
-    ssd1315_send_command(0xB0 + page);
-    ssd1315_send_command(0x00 + (col & 0x0F));
-    ssd1315_send_command(0x10 + ((col >> 4) & 0x0F));
-
-    while (*text) {
-        if (*text < 32 || *text > 127) {
-            text++;
-            continue;
-        }
-        uint8_t buf[6];
-        memcpy(buf, font5x8[*text - 32], 5);
-        buf[5] = 0x00; // spacing
-        ssd1315_send_data(buf, 6);
-        text++;
-    }
-}
 
-int main() {
-    i2c_fd = open(I2C_DEV, O_RDWR);
-    if (i2c_fd < 0) {
-        perror("Open I2C device");
-        exit(1);
-    }
-    if (ioctl(i2c_fd, I2C_SLAVE, I2C_ADDR) < 0) {
-        perror("Connect to I2C slave");
-        close(i2c_fd);
-        exit(1);
-    }
-
-    ssd1315_init();
-    ssd1315_clear();
-    ssd1315_write_text("Hello ", 0, 0);
-
-    close(i2c_fd);
-    return 0;
+	ssd1315_send_command(0xB0 + page);
+
+	ssd1315_send_command(0x00 + (col & 0x0F));
+
+	ssd1315_send_command(0x10 + ((col >> 4) & 0x0F));
+
+
+	while (*text) {
+
+		if (*text < 32 || *text > 127) {
+
+			text++;
+
+			continue;
+
+		}
+
+		uint8_t buf[6];
+
+		memcpy(buf, font5x8[*text - 32], 5);
+
+		buf[5] = 0x00; // spacing
+
+		ssd1315_send_data(buf, 6);
+
+		text++;
+
+	}
+
 }
+
+
+int main(int argc, char *argv[]) {
+
+	i2c_fd = open(I2C_DEV, O_RDWR);
+
+	if (i2c_fd < 0) {
+
+		perror("Open I2C device");
+
+		exit(1);
+
+	}
+
+	if (ioctl(i2c_fd, I2C_SLAVE, I2C_ADDR) < 0) {
+
+		perror("Connect to I2C slave");
+
+		close(i2c_fd);
+
+		exit(1);
+
+	}
+
+
+	ssd1315_init();
+
+	ssd1315_clear();
+
+	ssd1315_write_text("Hello ", 0, 0);
+
+	ssd1315_write_text(argv[1], 3, 0);
+
+
+	close(i2c_fd);
+
+	return 0;
+
+}
\ No newline at end of file
